<html>
  <head>
    <script src="../lib/jquery.js"></script>
    <script src="../dist/Bacon.js"></script>
    <script>
      $(function() {
        function isEmpty(s) { return s.length == 0 }

        function always(value) { return function() { return value }}
        
        function keyCodeIs(keyCode) { 
          return function(event) { return event.keyCode == keyCode }
        }

        function keyDownEvents(keyCode) { 
          return $(document).asEventStream("keydown").filter(keyCodeIs(keyCode))
        }

        function keyUpEvents(keyCode) { 
          return $(document).asEventStream("keyup").filter(keyCodeIs(keyCode))
        }

        function keyStateProperty(keyCode) { 
          return keyDownEvents(keyCode).map(always("DOWN"))
            .merge(keyUpEvents(keyCode).map(always("UP")))
            .toProperty("UP")
        }

        $("#clikme")
          .asEventStream("click")
          .subscribe(function(event) { alert("mmmm... bacon!") })

        keyStateProperty(32)
          .onValue(function(value) { $("#spacebar-value").text(value) })

        $("#enabling input")
          .asEventStream("keyup")
          .map(function(event) { return $(event.target).val() })
          .toProperty("")
          .map(isEmpty)
          .assign($("#enabling button"), "attr", "disabled")

        $('#echo input:eq(0)')
          .asEventStream('keyup')
          .map(function(e) { return $(e.target).val() })
          .onValue(function(str) { $('#echo input:eq(1)').val(str) })
 
        //number = 0
        //incr = $('#counter .incr').asEventStream('click').map(1)
        //decr = $('#counter .decr').asEventStream('click').map(-1)
        //both = incr.merge(decr).onValue(function(val) { 
        //  number += val 
        //  $('#counter .number').text(number)
        //})

        ;(function() {
          var ups = $('#counter .incr').asEventStream('click').map(1)
            , downs = $('#counter .decr').asEventStream('click').map(-1)
            , upsAndDowns = ups.merge(downs)
            , counter = upsAndDowns.scan(0, function(a,b) { return a + b })
          counter.onValue(function(val) { $('#counter .number').text(val) })
        })()

        ;(function() {
          var a, b, c
          a = $('#calculator .a')
                .asEventStream('change')
                .map(function(e) { return parseInt($(e.target).val()) })
                .toProperty( parseInt($('#calculator .a').val()) )
          b = $('#calculator .b')
                .asEventStream('change')
                .map(function(e) { return parseInt($(e.target).val()) })
                .toProperty( parseInt($('#calculator .b').val()) )
          c = a.combine(b, function(x, y) { return x + y})
          c.onValue(function(n) { $('#calculator .c').text(n) })
        })()
      })
    </script>
  </head>
  <body>
    <h1>bacon.js example page</h1>
    <div>
      <h2>Simplest example:</h2>
      <span id="clikme">click me</span>
    </div>
    <div>
      <h2>Combinators example:</h2>
      SPACEBAR value=<span id="spacebar-value"></span>
    </div>
    <div id="enabling">
      <h2>Enable/disable example:</h2>
      <input type="text" placeholder="required field">
      <button>Don't push me</button>
    </div>
    <div id="echo">
      <h2>Echo example:</h2>
      <div><input type="text" placeholder="If you say something..."></div>
      <div><input type="text" placeholder="...I'll say it right back"></div>
    </div>
    <div id="counter">
      <h2>Counter example:</h2>
      <button class="decr">-</button>
      <button class="incr">+</button>
      <span class="number"></span>
    </div>
    <div id="calculator">
      <h2>Calculator example:</h2>
      <input type="number" value="0" class="a">
        + <input type="number" value="0" class="b">
        = <span class="c"></span>
    </div>
  </body>
</html>
